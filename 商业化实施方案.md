# ğŸš€ Alpha Arena Live å•†ä¸šåŒ–å®æ–½æ–¹æ¡ˆ

## ğŸ“Š å½“å‰çŠ¶å†µåˆ†æ

### å¯ç”¨çš„ API æ•°æ®æº

| APIç«¯ç‚¹ | æ•°æ®ç±»å‹ | æ›´æ–°é¢‘ç‡ | å•†ä¸šä»·å€¼ |
|---------|----------|----------|----------|
| `/api/leaderboard` | æ’è¡Œæ¦œ | å®æ—¶ | â­â­â­â­â­ æœ€æ ¸å¿ƒ |
| `/api/analytics` | ç»¼åˆåˆ†æ | æ¯å°æ—¶ | â­â­â­â­â­ æœ€è¯¦ç»† |
| `/api/trades` | äº¤æ˜“è®°å½• | å®æ—¶ | â­â­â­â­â­ å†å²æ•°æ® |
| `/api/analytics/{model}` | å•æ¨¡å‹åˆ†æ | æ¯å°æ—¶ | â­â­â­â­ æ·±åº¦åˆ†æ |
| `/api/conversations` | AIå¯¹è¯è®°å½• | å®æ—¶ | â­â­â­â­ å†³ç­–è¿‡ç¨‹ |
| `/api/account-totals` | è´¦æˆ·æ€»é¢ | å®æ—¶ | â­â­â­ èµ„é‡‘è¿½è¸ª |
| `/api/since-inception-values` | è‡ªå¯åŠ¨æ•°æ® | æ¯æ—¥ | â­â­â­ é•¿æœŸè¶‹åŠ¿ |
| `/api/crypto-prices` | åŠ å¯†è´§å¸ä»·æ ¼ | å®æ—¶ | â­â­ è¾…åŠ©æ•°æ® |

### æŠ€æœ¯æ ˆç°çŠ¶
- âœ… **å‰ç«¯**: Next.js 14 + React + TypeScript
- âœ… **éƒ¨ç½²**: Cloudflare Workers (è¾¹ç¼˜è®¡ç®—)
- âœ… **æ•°æ®åº“**: Supabase (PostgreSQL)
- âœ… **AIç”Ÿæˆ**: OpenRouter API

---

## ğŸ¯ å•†ä¸šåŒ–ç›®æ ‡

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2ä¸ªæœˆï¼‰ï¼šå†…å®¹ä¸æµé‡
1. æ‰“é€ å†…å®¹ä¸°å¯Œçš„é¦–é¡µå’ŒLIVEé¡µé¢
2. æ¯æ—¥è‡ªåŠ¨ç”Ÿæˆé«˜è´¨é‡åˆ†ææ–‡ç« 
3. å»ºç«‹å®Œæ•´çš„æ•°æ®åº“ï¼Œå­˜å‚¨æ‰€æœ‰å†å²æ•°æ®
4. SEOä¼˜åŒ–ï¼Œè·å–è‡ªç„¶æµé‡

### ç¬¬äºŒé˜¶æ®µï¼ˆ2-4ä¸ªæœˆï¼‰ï¼šä»˜è´¹å†…å®¹
1. æ¨å‡ºä»˜è´¹APIæœåŠ¡
2. æä¾›é«˜çº§æ•°æ®åˆ†ææŠ¥å‘Š
3. å®æ—¶äº¤æ˜“ä¿¡å·æ¨é€
4. å†å²æ•°æ®ä¸‹è½½æœåŠ¡

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ4-6ä¸ªæœˆï¼‰ï¼šå¹³å°åŒ–
1. AIäº¤æ˜“ç­–ç•¥å›æµ‹å¹³å°
2. ç”¨æˆ·è‡ªå®šä¹‰è­¦æŠ¥ç³»ç»Ÿ
3. ç¤¾åŒºè®ºå›å’Œè®¨è®ºåŒº
4. è”ç›Ÿè¥é”€è®¡åˆ’

---

## ğŸ—ï¸ Cloudflare ç”Ÿæ€ç³»ç»Ÿæ•°æ®åº“æ–¹æ¡ˆ

### æ¨èæ¶æ„ï¼šSupabase + Cloudflare D1 æ··åˆæ–¹æ¡ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cloudflare Workers                    â”‚
â”‚                      (è¾¹ç¼˜è®¡ç®—å±‚)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                          â”‚
             â–¼                          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Cloudflare D1 â”‚        â”‚    Supabase        â”‚
    â”‚   (SQLite)     â”‚        â”‚  (PostgreSQL)      â”‚
    â”‚                â”‚        â”‚                    â”‚
    â”‚ â€¢ å®æ—¶æ•°æ®ç¼“å­˜  â”‚        â”‚ â€¢ å†å²äº¤æ˜“æ•°æ®      â”‚
    â”‚ â€¢ æ’è¡Œæ¦œå¿«ç…§    â”‚        â”‚ â€¢ æ–‡ç« å†…å®¹         â”‚
    â”‚ â€¢ æœ€æ–°100æ¡äº¤æ˜“ â”‚        â”‚ â€¢ åˆ†ææŠ¥å‘Š         â”‚
    â”‚ â€¢ çƒ­ç‚¹æ•°æ®      â”‚        â”‚ â€¢ ç”¨æˆ·æ•°æ®         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â€¢ å®Œæ•´analytics    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸ºä»€ä¹ˆé€‰æ‹©æ··åˆæ–¹æ¡ˆï¼Ÿ

#### Cloudflare D1 çš„ä¼˜åŠ¿
- âœ… **è¶…ä½å»¶è¿Ÿ**: è¾¹ç¼˜èŠ‚ç‚¹å°±è¿‘è®¿é—®ï¼ˆ<50msï¼‰
- âœ… **å…è´¹é¢åº¦**: æ¯å¤©500ä¸‡æ¬¡è¯»å– + 10ä¸‡æ¬¡å†™å…¥
- âœ… **è‡ªåŠ¨æ‰©å±•**: æ— éœ€é…ç½®ï¼Œè‡ªåŠ¨å…¨çƒåˆ†å‘
- âœ… **å®Œç¾é›†æˆ**: ä¸ Workers æ— ç¼é…åˆ

#### Supabase çš„ä¼˜åŠ¿
- âœ… **æˆç†Ÿçš„ PostgreSQL**: å¤æ‚æŸ¥è¯¢å’Œå…³ç³»å‹æ•°æ®
- âœ… **å®æ—¶è®¢é˜…**: WebSocket å®æ—¶æ•°æ®æ¨é€
- âœ… **å®Œæ•´åŠŸèƒ½**: è®¤è¯ã€å­˜å‚¨ã€è¾¹ç¼˜å‡½æ•°
- âœ… **å·²æœ‰é›†æˆ**: ç°æœ‰ä»£ç ç›´æ¥ä½¿ç”¨

#### æ•°æ®åˆ†å±‚ç­–ç•¥

**çƒ­æ•°æ®ï¼ˆCloudflare D1ï¼‰**ï¼š
- æœ€æ–°æ’è¡Œæ¦œï¼ˆç¼“å­˜5åˆ†é’Ÿï¼‰
- æœ€è¿‘100ç¬”äº¤æ˜“
- å®æ—¶ä»·æ ¼å¿«ç…§
- ä»Šæ—¥ç»Ÿè®¡æ•°æ®

**å†·æ•°æ®ï¼ˆSupabaseï¼‰**ï¼š
- å†å²äº¤æ˜“è®°å½•ï¼ˆå®Œæ•´ï¼‰
- æ‰€æœ‰æ–‡ç« å†…å®¹
- ç”¨æˆ·è´¦æˆ·å’Œè®¢é˜…
- å®Œæ•´åˆ†ææ•°æ®

---

## ğŸ“¦ æ•°æ®åº“ Schema è®¾è®¡

### Supabase è¡¨ç»“æ„

```sql
-- ========================================
-- 1. äº¤æ˜“è®°å½•è¡¨ï¼ˆå®Œæ•´å†å²ï¼‰
-- ========================================
CREATE TABLE trades (
  id TEXT PRIMARY KEY,
  trade_id TEXT UNIQUE NOT NULL,

  -- åŸºæœ¬ä¿¡æ¯
  symbol TEXT NOT NULL,
  side TEXT NOT NULL, -- 'long' | 'short'
  trade_type TEXT NOT NULL,
  model_id TEXT NOT NULL,
  quantity DECIMAL(20, 10) NOT NULL,
  leverage DECIMAL(5, 2) NOT NULL,
  confidence DECIMAL(5, 4),

  -- å…¥åœºæ•°æ®
  entry_time BIGINT NOT NULL,
  entry_human_time TIMESTAMP NOT NULL,
  entry_price DECIMAL(20, 10) NOT NULL,
  entry_sz DECIMAL(20, 10) NOT NULL,
  entry_tid BIGINT,
  entry_oid BIGINT,
  entry_crossed BOOLEAN,
  entry_commission_dollars DECIMAL(20, 10),
  entry_closed_pnl DECIMAL(20, 10),

  -- å‡ºåœºæ•°æ®
  exit_time BIGINT,
  exit_human_time TIMESTAMP,
  exit_price DECIMAL(20, 10),
  exit_sz DECIMAL(20, 10),
  exit_tid BIGINT,
  exit_oid BIGINT,
  exit_crossed BOOLEAN,
  exit_commission_dollars DECIMAL(20, 10),
  exit_closed_pnl DECIMAL(20, 10),

  -- ç›ˆäºç»Ÿè®¡
  realized_gross_pnl DECIMAL(20, 10),
  realized_net_pnl DECIMAL(20, 10),
  total_commission_dollars DECIMAL(20, 10),

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),

  -- ç´¢å¼•
  INDEX idx_model_id (model_id),
  INDEX idx_symbol (symbol),
  INDEX idx_entry_time (entry_time DESC),
  INDEX idx_trade_id (trade_id)
);

-- ========================================
-- 2. æ’è¡Œæ¦œå¿«ç…§è¡¨ï¼ˆæ¯å°æ—¶å¿«ç…§ï¼‰
-- ========================================
CREATE TABLE leaderboard_snapshots (
  id BIGSERIAL PRIMARY KEY,
  snapshot_time TIMESTAMP NOT NULL,

  -- æ¨¡å‹ä¿¡æ¯
  model_id TEXT NOT NULL,

  -- æ’è¡Œæ¦œæ•°æ®
  num_trades INTEGER NOT NULL,
  sharpe DECIMAL(10, 4),
  win_dollars DECIMAL(20, 10),
  num_losses INTEGER,
  lose_dollars DECIMAL(20, 10),
  return_pct DECIMAL(10, 4),
  equity DECIMAL(20, 10),
  num_wins INTEGER,

  -- æ’å
  rank INTEGER,

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),

  -- ç´¢å¼•
  INDEX idx_snapshot_time (snapshot_time DESC),
  INDEX idx_model_snapshot (model_id, snapshot_time DESC),
  UNIQUE (model_id, snapshot_time)
);

-- ========================================
-- 3. åˆ†ææ•°æ®è¡¨ï¼ˆè¯¦ç»†æŒ‡æ ‡ï¼‰
-- ========================================
CREATE TABLE analytics_snapshots (
  id BIGSERIAL PRIMARY KEY,
  snapshot_time TIMESTAMP NOT NULL,
  model_id TEXT NOT NULL,

  -- Fee & PnL Breakdown
  std_net_pnl DECIMAL(20, 10),
  total_fees_paid DECIMAL(20, 10),
  overall_pnl_without_fees DECIMAL(20, 10),
  total_fees_as_pct_of_pnl DECIMAL(10, 4),
  overall_pnl_with_fees DECIMAL(20, 10),
  avg_taker_fee DECIMAL(20, 10),
  std_gross_pnl DECIMAL(20, 10),
  avg_net_pnl DECIMAL(20, 10),
  biggest_net_loss DECIMAL(20, 10),
  biggest_net_gain DECIMAL(20, 10),
  avg_gross_pnl DECIMAL(20, 10),
  std_taker_fee DECIMAL(20, 10),

  -- Winners & Losers
  win_rate DECIMAL(5, 4),
  avg_winners_net_pnl DECIMAL(20, 10),
  avg_losers_net_pnl DECIMAL(20, 10),
  avg_winners_notional DECIMAL(20, 10),
  avg_losers_notional DECIMAL(20, 10),
  avg_winners_holding_period DECIMAL(20, 10),
  avg_losers_holding_period DECIMAL(20, 10),

  -- åŸå§‹JSONæ•°æ®ï¼ˆå®Œæ•´ä¿å­˜ï¼‰
  raw_data JSONB,

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),

  -- ç´¢å¼•
  INDEX idx_analytics_time (snapshot_time DESC),
  INDEX idx_analytics_model (model_id, snapshot_time DESC),
  UNIQUE (model_id, snapshot_time)
);

-- ========================================
-- 4. AIå¯¹è¯è®°å½•è¡¨
-- ========================================
CREATE TABLE ai_conversations (
  id TEXT PRIMARY KEY,
  model_id TEXT NOT NULL,
  conversation_time TIMESTAMP NOT NULL,

  -- å¯¹è¯å†…å®¹
  user_prompt TEXT,
  ai_response TEXT,

  -- å†³ç­–ç›¸å…³
  decision_type TEXT, -- 'entry' | 'exit' | 'hold'
  symbol TEXT,
  action_taken TEXT,
  confidence DECIMAL(5, 4),

  -- åŸå§‹æ•°æ®
  raw_data JSONB,

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),

  -- ç´¢å¼•
  INDEX idx_conversation_time (conversation_time DESC),
  INDEX idx_conversation_model (model_id, conversation_time DESC)
);

-- ========================================
-- 5. ç”Ÿæˆæ–‡ç« è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œä¿æŒä¸å˜ï¼‰
-- ========================================
-- ä½¿ç”¨ç°æœ‰çš„ articles è¡¨æˆ–æ–‡ä»¶ç³»ç»Ÿ

-- ========================================
-- 6. ä»˜è´¹ç”¨æˆ·è¡¨ï¼ˆå•†ä¸šåŒ–ï¼‰
-- ========================================
CREATE TABLE users (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  email TEXT UNIQUE NOT NULL,
  username TEXT UNIQUE,

  -- è®¢é˜…ä¿¡æ¯
  subscription_tier TEXT DEFAULT 'free', -- 'free' | 'pro' | 'enterprise'
  subscription_status TEXT DEFAULT 'active',
  subscription_start_date TIMESTAMP,
  subscription_end_date TIMESTAMP,

  -- APIè®¿é—®
  api_key TEXT UNIQUE,
  api_calls_count INTEGER DEFAULT 0,
  api_calls_limit INTEGER DEFAULT 100, -- æ¯æ—¥é™åˆ¶

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  last_login_at TIMESTAMP,

  -- ç´¢å¼•
  INDEX idx_email (email),
  INDEX idx_api_key (api_key)
);

-- ========================================
-- 7. APIè°ƒç”¨æ—¥å¿—è¡¨ï¼ˆå•†ä¸šåŒ–è¿½è¸ªï¼‰
-- ========================================
CREATE TABLE api_usage_logs (
  id BIGSERIAL PRIMARY KEY,
  user_id UUID REFERENCES users(id),

  -- è¯·æ±‚ä¿¡æ¯
  endpoint TEXT NOT NULL,
  method TEXT NOT NULL,
  query_params JSONB,

  -- å“åº”ä¿¡æ¯
  response_status INTEGER,
  response_time_ms INTEGER,
  data_returned_bytes INTEGER,

  -- è®¡è´¹ä¿¡æ¯
  credits_used DECIMAL(10, 4) DEFAULT 1,

  -- å…ƒæ•°æ®
  created_at TIMESTAMP DEFAULT NOW(),
  ip_address INET,
  user_agent TEXT,

  -- ç´¢å¼•
  INDEX idx_user_usage (user_id, created_at DESC),
  INDEX idx_endpoint_usage (endpoint, created_at DESC)
);
```

### Cloudflare D1 è¡¨ç»“æ„ï¼ˆç¼“å­˜å±‚ï¼‰

```sql
-- æ’è¡Œæ¦œç¼“å­˜ï¼ˆ5åˆ†é’Ÿåˆ·æ–°ï¼‰
CREATE TABLE leaderboard_cache (
  model_id TEXT PRIMARY KEY,
  num_trades INTEGER,
  sharpe REAL,
  win_dollars REAL,
  num_losses INTEGER,
  lose_dollars REAL,
  return_pct REAL,
  equity REAL,
  num_wins INTEGER,
  rank INTEGER,
  cached_at INTEGER -- Unix timestamp
);

-- æœ€æ–°äº¤æ˜“ç¼“å­˜ï¼ˆæœ€è¿‘100æ¡ï¼‰
CREATE TABLE recent_trades_cache (
  id TEXT PRIMARY KEY,
  trade_data TEXT, -- JSON string
  entry_time INTEGER,
  model_id TEXT,
  cached_at INTEGER
);
CREATE INDEX idx_recent_trades_time ON recent_trades_cache(entry_time DESC);
```

---

## ğŸ”„ æ•°æ®é‡‡é›†ä¸åŒæ­¥ç­–ç•¥

### 1. Cloudflare Cron Triggers è®¾ç½®

```toml
# wrangler.toml
[triggers]
# æ¯5åˆ†é’ŸåŒæ­¥å®æ—¶æ•°æ®åˆ°D1ç¼“å­˜
crons = ["*/5 * * * *"]

# æˆ–æ›´ç»†åŒ–ï¼š
# crons = [
#   "*/5 * * * *",    # å®æ—¶æ•°æ®åŒæ­¥ï¼ˆleaderboard, tradesï¼‰
#   "0 * * * *",      # æ¯å°æ—¶åŒæ­¥analytics
#   "0 0 * * *"       # æ¯å¤©ç”Ÿæˆæ–‡ç« 
# ]
```

### 2. æ•°æ®åŒæ­¥è„šæœ¬æ¶æ„

```typescript
// src/app/api/cron/sync-data/route.ts
export async function GET(request: NextRequest) {
  // éªŒè¯Cron Secret
  const authHeader = request.headers.get('authorization')
  if (authHeader !== `Bearer ${process.env.CRON_SECRET}`) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })
  }

  try {
    // å¹¶è¡Œæ‰§è¡Œå¤šä¸ªåŒæ­¥ä»»åŠ¡
    const results = await Promise.allSettled([
      syncLeaderboard(),
      syncTrades(),
      syncAnalytics(),
      updateD1Cache(),
    ])

    return NextResponse.json({
      success: true,
      results: results.map(r => r.status),
      timestamp: new Date().toISOString()
    })
  } catch (error) {
    return NextResponse.json({ error: error.message }, { status: 500 })
  }
}

// åŒæ­¥æ’è¡Œæ¦œ
async function syncLeaderboard() {
  const response = await fetch('https://nof1.ai/api/leaderboard')
  const data = await response.json()

  // ä¿å­˜åˆ°Supabaseï¼ˆå†å²å¿«ç…§ï¼‰
  await supabase.from('leaderboard_snapshots').insert(
    data.leaderboard.map((item, index) => ({
      snapshot_time: new Date(),
      model_id: item.id,
      rank: index + 1,
      ...item
    }))
  )

  // æ›´æ–°D1ç¼“å­˜ï¼ˆå®æ—¶æ•°æ®ï¼‰
  for (const [index, item] of data.leaderboard.entries()) {
    await env.DB.prepare(`
      INSERT OR REPLACE INTO leaderboard_cache VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)
    `).bind(
      item.id, item.num_trades, item.sharpe, item.win_dollars,
      item.num_losses, item.lose_dollars, item.return_pct,
      item.equity, item.num_wins, index + 1, Date.now()
    ).run()
  }
}

// åŒæ­¥äº¤æ˜“è®°å½•
async function syncTrades() {
  const response = await fetch('https://nof1.ai/api/trades')
  const data = await response.json()

  // è·å–å·²æœ‰çš„trade_id
  const { data: existingTrades } = await supabase
    .from('trades')
    .select('trade_id')

  const existingIds = new Set(existingTrades?.map(t => t.trade_id) || [])

  // åªæ’å…¥æ–°äº¤æ˜“
  const newTrades = data.trades.filter(t => !existingIds.has(t.trade_id))

  if (newTrades.length > 0) {
    await supabase.from('trades').insert(newTrades.map(trade => ({
      id: trade.id,
      trade_id: trade.trade_id,
      // ... æ˜ å°„æ‰€æœ‰å­—æ®µ
    })))
  }

  return { new_trades: newTrades.length }
}

// åŒæ­¥åˆ†ææ•°æ®
async function syncAnalytics() {
  const response = await fetch('https://nof1.ai/api/analytics')
  const data = await response.json()

  await supabase.from('analytics_snapshots').insert(
    data.analytics.map(item => ({
      snapshot_time: new Date(data.serverTime),
      model_id: item.model_id,
      // æå–å…³é”®æŒ‡æ ‡
      win_rate: item.winners_losers_breakdown_table?.win_rate,
      avg_net_pnl: item.fee_pnl_moves_breakdown_table?.avg_net_pnl,
      // ... å…¶ä»–å­—æ®µ
      raw_data: item // ä¿å­˜å®Œæ•´JSON
    }))
  )
}
```

---

## ğŸ“ å†…å®¹ç”Ÿæˆç³»ç»Ÿè®¾è®¡

### è‡ªåŠ¨æ–‡ç« ç”Ÿæˆæµç¨‹

```mermaid
graph LR
    A[Cronè§¦å‘] --> B[è·å–æœ€æ–°æ•°æ®]
    B --> C[æ•°æ®åˆ†æ]
    C --> D[ç”Ÿæˆæ–‡ç« å¤§çº²]
    D --> E[AIç”Ÿæˆå†…å®¹]
    E --> F[ä¿å­˜Markdown]
    F --> G[æ„å»ºæ—¶ç”Ÿæˆé™æ€é¡µ]
    G --> H[éƒ¨ç½²åˆ°Cloudflare]
```

### æ–‡ç« ç±»å‹è§„åˆ’

#### 1. æ¯æ—¥äº¤æ˜“æŠ¥å‘Šï¼ˆDaily Reportï¼‰
**é¢‘ç‡**: æ¯å¤© 1 ç¯‡
**å†…å®¹**:
- ä»Šæ—¥æ’è¡Œæ¦œå˜åŒ–
- å„æ¨¡å‹äº¤æ˜“ç»Ÿè®¡
- æœ€å¤§ç›ˆåˆ©/äºæŸäº¤æ˜“
- å¸‚åœºè¡Œæƒ…åˆ†æ

**ç”Ÿæˆæ—¶é—´**: æ¯å¤© UTC 00:00ï¼ˆåŒ—äº¬æ—¶é—´ 08:00ï¼‰

#### 2. å‘¨åº¦ç­–ç•¥åˆ†æï¼ˆWeekly Strategyï¼‰
**é¢‘ç‡**: æ¯å‘¨ 1 ç¯‡
**å†…å®¹**:
- æœ¬å‘¨èƒœç‡æœ€é«˜æ¨¡å‹
- ç­–ç•¥æ¨¡å¼åˆ†æ
- é•¿çº¿ vs çŸ­çº¿å¯¹æ¯”
- é£é™©ç®¡ç†æ´å¯Ÿ

**ç”Ÿæˆæ—¶é—´**: æ¯å‘¨ä¸€ UTC 00:00

#### 3. æ¨¡å‹æ·±åº¦åˆ†æï¼ˆModel Deep Diveï¼‰
**é¢‘ç‡**: æ¯å‘¨ 2-3 ç¯‡
**å†…å®¹**:
- å•ä¸ªæ¨¡å‹å®Œæ•´è¡¨ç°
- äº¤æ˜“é£æ ¼ç‰¹å¾
- å†³ç­–è¿‡ç¨‹åˆ†æï¼ˆåŸºäºconversationsï¼‰
- ä¼˜åŒ–å»ºè®®

#### 4. å¸‚åœºæ´å¯Ÿï¼ˆMarket Insightsï¼‰
**é¢‘ç‡**: æ ¹æ®å¸‚åœºæ³¢åŠ¨è§¦å‘
**è§¦å‘æ¡ä»¶**:
- æŸæ¨¡å‹æ”¶ç›Šç‡å˜åŒ– > 10%
- å¸‚åœºæç«¯æ³¢åŠ¨
- æ–°çš„äº¤æ˜“æ¨¡å¼å‡ºç°

### æ–‡ç« ç”Ÿæˆè„šæœ¬

```typescript
// scripts/generate-daily-report.ts
import { OpenAI } from 'openai'
import fs from 'fs'
import path from 'path'

async function generateDailyReport() {
  // 1. è·å–ä»Šæ—¥æ•°æ®
  const leaderboard = await fetchLeaderboard()
  const todayTrades = await fetchTodayTrades()
  const analytics = await fetchAnalytics()

  // 2. æ•°æ®åˆ†æ
  const topPerformer = leaderboard[0]
  const totalTrades = todayTrades.length
  const totalPnL = todayTrades.reduce((sum, t) => sum + t.realized_net_pnl, 0)

  // 3. æ„å»ºæç¤ºè¯
  const prompt = `
ä½œä¸ºä¸€ä½ä¸“ä¸šçš„åŠ å¯†è´§å¸äº¤æ˜“åˆ†æå¸ˆï¼Œè¯·åŸºäºä»¥ä¸‹æ•°æ®ç”Ÿæˆä¸€ç¯‡æ·±åº¦åˆ†ææ–‡ç« ï¼š

# ä»Šæ—¥æ•°æ®æ¦‚è§ˆ
- æ€»äº¤æ˜“æ•°: ${totalTrades}
- æ€»ç›ˆäº: $${totalPnL.toFixed(2)}
- æœ€ä½³è¡¨ç°: ${topPerformer.id} (æ”¶ç›Šç‡: ${topPerformer.return_pct}%)

# æ’è¡Œæ¦œæ•°æ®
${JSON.stringify(leaderboard, null, 2)}

# äº¤æ˜“è®°å½•
${JSON.stringify(todayTrades.slice(0, 10), null, 2)}

è¯·ç”Ÿæˆä¸€ç¯‡ç»“æ„åŒ–çš„åˆ†ææ–‡ç« ï¼ŒåŒ…æ‹¬ï¼š
1. æ‰§è¡Œæ‘˜è¦
2. æ’è¡Œæ¦œå˜åŒ–åˆ†æ
3. äº¤æ˜“ç­–ç•¥æ´å¯Ÿ
4. é£é™©æç¤º
5. æ˜æ—¥å±•æœ›

ä½¿ç”¨Markdownæ ¼å¼ï¼ŒåŒ…å«æ ‡é¢˜ã€åˆ—è¡¨ã€è¡¨æ ¼ã€‚
`

  // 4. AIç”Ÿæˆå†…å®¹
  const openai = new OpenAI({
    baseURL: 'https://openrouter.ai/api/v1',
    apiKey: process.env.OPENROUTER_API_KEY,
  })

  const completion = await openai.chat.completions.create({
    model: 'anthropic/claude-3.5-sonnet',
    messages: [{ role: 'user', content: prompt }],
    temperature: 0.7,
  })

  const content = completion.choices[0].message.content

  // 5. ç”ŸæˆFrontmatter
  const today = new Date().toISOString().split('T')[0]
  const slug = `daily-report-${today}`

  const markdown = `---
title: "Alpha Arena æ¯æ—¥äº¤æ˜“æŠ¥å‘Š - ${today}"
excerpt: "${topPerformer.id} ä»¥ ${topPerformer.return_pct}% çš„æ”¶ç›Šç‡é¢†è·‘ï¼Œå…±æ‰§è¡Œ ${totalTrades} ç¬”äº¤æ˜“"
category: "daily-report"
tags: ["daily", "trading", "analysis", "${topPerformer.id}"]
publishedAt: "${new Date().toISOString()}"
readTime: 8
---

${content}
`

  // 6. ä¿å­˜æ–‡ä»¶
  const filePath = path.join(process.cwd(), 'content/articles', `${slug}.md`)
  fs.writeFileSync(filePath, markdown, 'utf8')

  console.log(`âœ… Generated article: ${slug}`)
}

generateDailyReport()
```

---

## ğŸ¨ é¦–é¡µå’ŒLIVEé¡µé¢è®¾è®¡æ–¹æ¡ˆ

### é¦–é¡µï¼ˆHomepageï¼‰é‡æ–°è®¾è®¡

```tsx
// src/app/page.tsx
export default function HomePage() {
  return (
    <>
      {/* Hero Section - å®æ—¶æ’è¡Œæ¦œ */}
      <section className="hero">
        <h1>AI Trading Competition Live Tracker</h1>
        <LiveLeaderboard /> {/* ä»D1ç¼“å­˜åŠ è½½ï¼Œ<50ms */}
      </section>

      {/* Real-time Stats */}
      <section className="stats-grid">
        <StatCard title="Total Trades Today" value="1,247" />
        <StatCard title="Total P&L" value="+$12,456" />
        <StatCard title="Best Performer" value="qwen3-max" />
        <StatCard title="Win Rate" value="64.3%" />
      </section>

      {/* å®æ—¶äº¤æ˜“æµ */}
      <section className="live-trades">
        <h2>Recent Trades</h2>
        <TradesFeed /> {/* WebSocketå®æ—¶æ›´æ–° */}
      </section>

      {/* æœ€æ–°æ–‡ç«  */}
      <section className="latest-articles">
        <h2>Latest Analysis</h2>
        <ArticleGrid articles={latestArticles} />
      </section>

      {/* æ€§èƒ½å¯¹æ¯”å›¾è¡¨ */}
      <section className="performance-charts">
        <EquityCurveChart />
        <WinRateComparison />
      </section>
    </>
  )
}
```

### LIVEé¡µé¢ï¼ˆå®æ—¶è¿½è¸ªï¼‰è®¾è®¡

```tsx
// src/app/live/page.tsx
export default function LivePage() {
  return (
    <>
      {/* å®æ—¶æ’è¡Œæ¦œ */}
      <LiveLeaderboard />

      {/* å®æ—¶äº¤æ˜“è¡¨æ ¼ */}
      <LiveTradesTable />

      {/* ä»·æ ¼å›¾è¡¨ */}
      <PriceCharts symbols={['BTC', 'ETH', 'SOL']} />

      {/* AIå†³ç­–æ—¥å¿— */}
      <AIDecisionLog />
    </>
  )
}

// ä½¿ç”¨Supabase Realtimeè®¢é˜…
function LiveTradesTable() {
  const [trades, setTrades] = useState([])

  useEffect(() => {
    const channel = supabase
      .channel('trades')
      .on('postgres_changes', {
        event: 'INSERT',
        schema: 'public',
        table: 'trades'
      }, payload => {
        setTrades(prev => [payload.new, ...prev].slice(0, 100))
      })
      .subscribe()

    return () => supabase.removeChannel(channel)
  }, [])

  return <TradesTable trades={trades} />
}
```

---

## ğŸ’° å•†ä¸šåŒ–APIè®¾è®¡

### APIå±‚çº§å®šä»·

| å±‚çº§ | ä»·æ ¼ | è¯·æ±‚é™åˆ¶ | åŠŸèƒ½ |
|------|------|----------|------|
| **Free** | $0/æœˆ | 100æ¬¡/å¤© | åŸºç¡€æ’è¡Œæ¦œã€æœ€æ–°10ç¬”äº¤æ˜“ |
| **Pro** | $29/æœˆ | 10,000æ¬¡/å¤© | å®Œæ•´å†å²æ•°æ®ã€å®æ—¶WebSocket |
| **Enterprise** | $299/æœˆ | æ— é™åˆ¶ | æ‰€æœ‰åŠŸèƒ½ã€ä¸“å±æ”¯æŒã€ç™½æ ‡ |

### APIç«¯ç‚¹è®¾è®¡

```typescript
// å…¬å¼€APIï¼ˆå…è´¹ï¼‰
GET /api/v1/leaderboard
GET /api/v1/trades/recent?limit=10

// ä»˜è´¹APIï¼ˆéœ€è¦API Keyï¼‰
GET /api/v1/trades/history?from=2025-01-01&to=2025-01-31
GET /api/v1/analytics/{model_id}?timeframe=7d
GET /api/v1/trades/export?format=csv
GET /api/v1/signals/realtime (WebSocket)

// è¯·æ±‚å¤´éªŒè¯
Authorization: Bearer {api_key}
```

### API Gateway å®ç°

```typescript
// src/middleware.ts
export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname

  // å¦‚æœæ˜¯ä»˜è´¹APIè·¯å¾„
  if (pathname.startsWith('/api/v1/')) {
    const apiKey = request.headers.get('authorization')?.replace('Bearer ', '')

    if (!apiKey) {
      return NextResponse.json({ error: 'API key required' }, { status: 401 })
    }

    // ä»D1æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼ˆå¿«é€Ÿï¼‰
    const user = await env.DB.prepare(
      'SELECT * FROM users WHERE api_key = ?'
    ).bind(apiKey).first()

    if (!user) {
      return NextResponse.json({ error: 'Invalid API key' }, { status: 401 })
    }

    // æ£€æŸ¥é…é¢
    if (user.api_calls_count >= user.api_calls_limit) {
      return NextResponse.json({ error: 'Rate limit exceeded' }, { status: 429 })
    }

    // è®°å½•APIè°ƒç”¨ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
    logApiCall(user.id, pathname)

    // å°†ç”¨æˆ·ä¿¡æ¯æ·»åŠ åˆ°è¯·æ±‚å¤´
    request.headers.set('x-user-id', user.id)
  }

  return NextResponse.next()
}
```

---

## ğŸ“ˆ å®æ–½æ—¶é—´è¡¨

### Week 1-2: æ•°æ®åŸºç¡€è®¾æ–½
- [x] åˆ›å»ºSupabaseè¡¨ç»“æ„
- [ ] è®¾ç½®Cloudflare D1æ•°æ®åº“
- [ ] å®ç°æ•°æ®åŒæ­¥è„šæœ¬
- [ ] é…ç½®Cron Triggers

### Week 3-4: é¦–é¡µå’ŒLIVEé¡µé¢
- [ ] é‡æ–°è®¾è®¡é¦–é¡µç»„ä»¶
- [ ] å®ç°å®æ—¶æ•°æ®å±•ç¤º
- [ ] æ·»åŠ äº¤äº’å¼å›¾è¡¨
- [ ] ä¼˜åŒ–æ€§èƒ½ï¼ˆD1ç¼“å­˜ï¼‰

### Week 5-6: å†…å®¹ç”Ÿæˆç³»ç»Ÿ
- [ ] å®Œå–„æ–‡ç« ç”Ÿæˆè„šæœ¬
- [ ] è®¾ç½®æ¯æ—¥è‡ªåŠ¨ç”Ÿæˆ
- [ ] ä¼˜åŒ–AIæç¤ºè¯
- [ ] æ·»åŠ å¤šç§æ–‡ç« ç±»å‹

### Week 7-8: å•†ä¸šåŒ–å‡†å¤‡
- [ ] å®ç°ç”¨æˆ·è®¤è¯ç³»ç»Ÿ
- [ ] åˆ›å»ºAPI Keyç®¡ç†
- [ ] è®¾ç½®æ”¯ä»˜é›†æˆï¼ˆStripeï¼‰
- [ ] å®ç°API Gateway

### Week 9-10: æµ‹è¯•å’Œä¼˜åŒ–
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] SEOä¼˜åŒ–
- [ ] æ–‡æ¡£ç¼–å†™
- [ ] Betaç”¨æˆ·æµ‹è¯•

### Week 11-12: æ­£å¼å‘å¸ƒ
- [ ] å…¬å¼€å‘å¸ƒä»˜è´¹API
- [ ] è¥é”€æ¨å¹¿
- [ ] ç›‘æ§å’Œè¿­ä»£

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¼€å§‹ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰

1. **åˆ›å»ºSupabaseè¡¨ç»“æ„**
   ```bash
   # åœ¨Supabase SQL Editorä¸­æ‰§è¡Œschema
   ```

2. **å®Œå–„æ•°æ®åŒæ­¥è„šæœ¬**
   ```bash
   # åˆ›å»ºå®Œæ•´çš„sync-all-data.ts
   pnpm create-sync-script
   ```

3. **è®¾ç½®Cloudflare Cron**
   ```bash
   # é…ç½®è‡ªåŠ¨æ‰§è¡Œ
   ```

4. **ä¼˜åŒ–é¦–é¡µå±•ç¤º**
   ```bash
   # é‡æ–°è®¾è®¡HomePageç»„ä»¶
   ```

### æˆåŠŸæŒ‡æ ‡

- âœ… æ•°æ®åº“ä¸­å­˜å‚¨è‡³å°‘7å¤©å†å²æ•°æ®
- âœ… æ¯æ—¥è‡ªåŠ¨ç”Ÿæˆ1ç¯‡æ–‡ç« 
- âœ… é¦–é¡µåŠ è½½æ—¶é—´ < 1ç§’
- âœ… APIå“åº”æ—¶é—´ < 200ms
- âœ… æœˆåº¦ç‹¬ç«‹è®¿å®¢ > 10,000

---

## ğŸ’¡ å•†ä¸šåŒ–å»ºè®®

### æ”¶å…¥æ¨¡å‹
1. **APIè®¢é˜…**: æœˆåº¦ç»å¸¸æ€§æ”¶å…¥ï¼ˆMRRï¼‰
2. **æ•°æ®å¯¼å‡º**: ä¸€æ¬¡æ€§ä»˜è´¹ä¸‹è½½å†å²æ•°æ®
3. **ç™½æ ‡æœåŠ¡**: ä¸ºå…¶ä»–å¹³å°æä¾›æ•°æ®API
4. **å¹¿å‘Š**: Google AdSense + ç›´æ¥å¹¿å‘Šé”€å”®
5. **è”ç›Ÿè¥é”€**: äº¤æ˜“æ‰€è¿”ä½£

### ç›®æ ‡å®¢æˆ·
- åŠ å¯†è´§å¸äº¤æ˜“è€…
- é‡åŒ–åŸºé‡‘
- AIç ”ç©¶äººå‘˜
- é‡‘èç§‘æŠ€å…¬å¸
- æ–°é—»åª’ä½“

### å¸‚åœºå®šä½
> "å®æ—¶è¿½è¸ªå’Œåˆ†æAIäº¤æ˜“ç«èµ›çš„ä¸“ä¸šæ•°æ®å¹³å°"

---

## ğŸ” å®‰å…¨è€ƒè™‘

1. **APIå¯†é’¥ç®¡ç†**: ä½¿ç”¨Cloudflare Workers Secrets
2. **é€Ÿç‡é™åˆ¶**: Cloudflare Workers KVå­˜å‚¨
3. **DDoSé˜²æŠ¤**: Cloudflareè‡ªåŠ¨é˜²æŠ¤
4. **æ•°æ®åŠ å¯†**: HTTPS + PostgreSQLåŠ å¯†
5. **è®¿é—®æ—¥å¿—**: å®Œæ•´çš„å®¡è®¡æ—¥å¿—

---

## ğŸ“š æŠ€æœ¯æ–‡æ¡£

è¯¦ç»†å®æ–½æ–‡æ¡£å°†åœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­æä¾›ï¼š
- `docs/DATABASE_SCHEMA.md` - å®Œæ•´æ•°æ®åº“è®¾è®¡
- `docs/API_REFERENCE.md` - APIæ–‡æ¡£
- `docs/DEPLOYMENT.md` - éƒ¨ç½²æŒ‡å—
- `docs/CRON_SETUP.md` - å®šæ—¶ä»»åŠ¡é…ç½®

---

**å¼€å§‹å®æ–½å§ï¼** ğŸš€

ä»åˆ›å»ºæ•°æ®åº“è¡¨å¼€å§‹ï¼Œç„¶åé€æ­¥å®Œå–„æ•°æ®é‡‡é›†å’Œå†…å®¹ç”Ÿæˆç³»ç»Ÿã€‚æœ‰ä»»ä½•é—®é¢˜éšæ—¶å‘Šè¯‰æˆ‘ï¼
